#!/usr/bin/env node

var fs = require('fs'),
	path = require('path'),
	Optimum = require('../lib/Optimum'),
	async = require('async'),
	_ = require('lodash');

var opt = new Optimum();

opt.on('resource', function(type, relPath, content) {
	//console.log('resource %s\n%s', relPath, content);
	fs.writeFileSync(path.resolve(opt.options.outputDirectory, relPath), content, { encoding: 'utf-8' });
});

opt.on('document', function(relPath, content) {
	console.log('OPTIMIZED %s', relPath);
	fs.writeFileSync(path.resolve(opt.options.outputDirectory, relPath), content, { encoding: 'utf-8' });
});

async.series(_.map(process.argv.slice(2), function (htmlFile) {
	return function (done) {
		opt.optimize(path.resolve(process.cwd(), htmlFile), done);
	};
}), function (err) {
	if (err) console.log(err);
	console.log('Optimization complete');
});
